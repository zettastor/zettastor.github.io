---
title: 配置与部署DBS
description: Docs intro
layout: ~/layouts/MainLayout.astro
---

分布式块存储的部署操作，在分布式块存储工具包的解压目录下，通常为 `/opt/deploy/Installation` 目录，赋予 `install.sh` 脚本执行权限

>由于 Linux 的 framebuffer 默认不支持汉字，以下操作需要通过 ssh 终端完成。

## 一、修改配置

执行下列命令，按照提示填写相关配置即可
```
LANGUAGE=zh_CN ./install.sh
```
1. 配置集群用户名和密码
2. 配置集群地址  
IP地址之间使用逗号分隔表示多个独立IP地址，使用冒号分隔表示连续IP地址。  
`10.0.3.174:10.0.3.176` 指174、175、176三台服务器  
`10.0.3.174,10.0.3.176` 指174、176两台服务器
```
=== (2/18): 配置集群地址 ===
集群节点 IP 地址:
192.168.1.12:192.168.1.15,192.168.1.17,192.168.1.18
此配置是否正确且完整?
按 Enter 继续，[M] 修改，[P] 返回上一步:
```
3. 配置集群主机名前缀
5. 配置 NTP 模式  
时间同步服务器的类型默认选择 `ntpdate`，CentOS 8 或 Redhat 8 请选择 `chrony`
```
=== (5/18): 配置 NTP 模式 ===
集群节点 NTP 模式: ntpdate
此配置是否正确且完整?
按 Enter 继续，[M] 修改，[P] 返回上一步:
```
6. 配置 NTP 服务器  
此处可以使用集群内的节点，也可以使用外部已有的时间服务器地址，以确保集群各节点之间时间同步。
```
=== (6/18): 配置 NTP 服务器 ===
集群节点 NTP 服务器地址:
192.168.1.12
此配置是否正确且完整?
按 Enter 继续，[M] 修改，[P] 返回上一步:
```
7. 配置数据库模式  
集群方式共分为single、etcd、pacemaker三种
8. 配置数据库主机  
当数据库集群模式选择etcd、pacemaker时需配置，否则自动跳过
9. 配置数据库从机  
仅当数据库集群模式选择 pacemaker 时需配置，否则自动跳过
10. 配置数据库地址  
single 需要 1 个节点，pacemaker 需要 2 个节点，etcd 需要 3 个节点
11. 配置 HA 服务  
节点数需≥2
12. 配置存储服务  
通常为集群的所有节点
13. 配置 Web 界面
14. 是否启用数控分离网络？  
如果此处选择false，向导会自动跳过步骤16、17
15. 控制网络的网段
16. 你是在物理服务器上部署吗？

至此，修改配置的操作已经全部完成。 

## 二、部署服务
执行下列命令，即可自动部署 dbs 服务。
```
LANGUAGE=zh_CN ./install.sh -b
```

自动部署包括下列 10 个步骤，执行过程无需用户交互。**因集群节点数量、硬件配置、磁盘配置等不同，部署时间差异较大，请耐心等待，不要中断部署操作。**
```
=== (1/10): 设置部署服务器 ===
在当前主机上安装软件包，用于设置部署服务器。

=== (2/10): 检查部署服务器 ===
检查当前主机是否符合部署服务器的要求。

=== (3/10): 检查集群节点 ===
检查集群主机是否符合部署服务器的要求。

=== (4/10): 设置集群节点 ===
在集群节点上安装软件包。

=== (5/10): 安装时间同步服务 ===
在集群节点上安装ntpdate或chrony服务。

=== (6/10): 时间同步 ===
集群主机时间同步。

=== (7/10): 检查集群状态 ===
检查集群主机的状态。

=== (8/10): 安装数据库服务 ===
安装产品所需的数据库服务 (PostgreSQL)。

=== (9/10): 更新系统配置 ===
更新产品的配置设置。

=== (10/10): 部署块存储 ===
部署位于Installation文件夹的父文件夹下的tar.gz安装包。
```

如果出现错误则会，例如
步骤6执行完之后如果错误退出，可以先比对集群节点时间是否相同，如果相同，重新执行 `install.sh` 脚本，步骤六（包含）前的步骤全部按S跳过。
```
ERROR
```

部署完毕之后，可通过浏览器访问分布式块存储 Web 界面，访问地址为http://*console_ip_address*:8080 其中 *console_ip_address* 为修改配置第13步中配置的“Web 界面的 IP 地址”
有关分布式块存储的操作与使用，请参考《分布式块存储系统用户手册》。


## 三、清除部署
因为某种原因，需要对分布式块存储进行清除操作，请在分布式块存储工具包的部署目录下（通常为 `/opt/deploy/Installation`），执行
```
perl product_block_storage_operation.pl -o wipeout
```

